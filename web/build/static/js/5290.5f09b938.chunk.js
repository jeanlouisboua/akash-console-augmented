"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[5290],{94623:function(e,n,r){function t(e){return null!==e&&"object"===typeof e&&Object.prototype.hasOwnProperty.call(e,"message")}r.d(n,{V:function(){return t}})},40714:function(e,n,r){r.d(n,{Lw:function(){return g},Ow:function(){return p},k$:function(){return b}});var t,o,s,a,i,d,l=r(50669),u=r(47292),c=r(63576),f=r(54379),p=(u.Z.label(t||(t=(0,l.Z)(["\n  position: relative;\n  padding-left: 5px;\n"]))),u.Z.div(o||(o=(0,l.Z)(["\n  display: flex;\n  justify-content: flex-end;\n"])))),m=(0,c.iv)(s||(s=(0,l.Z)(["\n  padding: 10px 32px;\n  gap: 8px;\n  color: #374151;\n  text-transform: capitalize;\n  background-color: #ffffff;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\n  border: 1px solid #d7d7d7;\n  border-radius: 6px;\n\n  &:hover {\n    border-color: #3d4148;\n  }\n"]))),x=(0,u.Z)(f.Z)(a||(a=(0,l.Z)(["\n  ",";\n  margin-right: 20px;\n  border-radius: 8px;\n  font-family: 'Satoshi-Medium', sans-serif;\n  font-size: 14px;\n  box-shadow: 0px 1px 2px 0px #0000000d;\n\n  &:hover {\n    background-color: #f4f5f8;\n  }\n"])),m),g=(0,u.Z)(x)(i||(i=(0,l.Z)(["\n  margin-left: auto;\n"]))),b=(0,u.Z)(f.Z)(d||(d=(0,l.Z)(["\n  ",";\n  background-color: #e11d48;\n  color: white;\n  align-self: end;\n\n  &:hover {\n    background-color: #925562;\n  }\n\n  &:disabled {\n    color: white;\n    background-color: #7e7073;\n  }\n"])),m)},65290:function(e,n,r){r.r(n),r.d(n,{default:function(){return M}});var t=r(50669),o=r(11092),s=r(27791),a=r(50189),i=r(11026),d=r(56167),l=r(97798),u=r(34347),c=r(47292),f=r(40714),p=r(87176),m=r(99377),x=r(54379),g=r(63576),b=r(95958),v=r(24488),Z=r(88848),h=r(270);var y,w,S=function(e){var n=(0,d.useState)(null),r=(0,i.Z)(n,2),t=r[0],o=r[1];return(0,d.useEffect)((function(){var n=e?localStorage.getItem(e):null,r=n?JSON.parse(n):null;o(r)}),[e]),t},k=r(94623),j=r(55119),I=r(52145),z=r(462),O=r(79139),C=r(37878),E=r(52712).Buffer,M=function(){var e,n=(0,l.s0)(),r=(0,l.UO)().dseq,t=(0,p.FV)(m._i),c=(0,i.Z)(t,2),x=c[0],g=c[1],y=(0,d.useState)(!1),w=(0,i.Z)(y,2),M=w[0],U=w[1],q=(0,d.useCallback)((function(){return U(!1)}),[]),D=S(r),L=(0,d.useState)(""),F=(0,i.Z)(L,2),N=F[0],A=F[1],J=(0,j.XG)().networkType,Q={owner:x.accounts[0].address,dseq:r||"0"},P=(0,z.useQuery)(["deployment",Q],I.an).data,R={owner:x.accounts[0].address,dseq:r||"0"},T=(0,z.useQuery)(["lease",R],I.eu).data,$=(0,z.useMutation)(O.A1),B=$.mutate,G=$.isLoading,W=(0,z.useMutation)(O.Wl),X=W.mutate,_=W.isLoading,H=null===P||void 0===P||null===(e=P.deployment)||void 0===e?void 0:e.deployment,K=null!==T&&void 0!==T&&T.leases.length?T.leases[0].lease:void 0,Y=G||_,ee="testnet"===J?"beta3":"beta2";return null===D?(0,C.jsx)(C.Fragment,{children:"Invalid DSEQ"}):(0,C.jsx)(u.J9,{enableReinitialize:!0,initialValues:(0,a.Z)((0,a.Z)({},v.Sc),{},{appName:D.name,sdl:D.sdl}),onSubmit:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var s,a,d,l,u,c,f,p;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(A("Updating deployment"),s="n/a",a="n/a",d="n/a",l="n/a",u=0,t.sdl){e.next=9;break}return console.log("Update deployment called with invalid SDL"),e.abrupt("return");case 9:return e.next=11,(0,h.Ir)(t.sdl,ee);case 11:if(c=e.sent,f=E.from(c).toString("base64"),p=E.from(null===H||void 0===H?void 0:H.version).toString("base64"),K){e.next=16;break}return e.abrupt("return");case 16:if(p!==f){e.next=19;break}return B({address:x.accounts[0].address,lease:K,sdl:t.sdl},{onSuccess:function(){Z.Z.success("Manifest successfully updated"),n(-1)},onError:function(e){Z.Z.log("Failed to send manifest: ".concat(e))}}),e.abrupt("return");case 19:try{X({wallet:x,deploymentId:{owner:x.accounts[0].address,dseq:r},sdl:t.sdl},{onSuccess:function(e){e.deploymentId&&t.sdl&&(A("Sending manifest"),B({address:x.accounts[0].address,lease:K,sdl:t.sdl},{onSuccess:function(){for(var r=t.sdl,o=0,c=Object.entries(r.services);o<c.length;o++){var f=(0,i.Z)(c[o],1)[0];if(0===u&&(r.services[f]&&r.services[f].image&&(s=r.services[f].image),r.profiles.compute[f]&&r.profiles.compute[f].resources)){var p=r.profiles.compute[f].resources;a=p.cpu.units,d=p.memory.size,l=Array.isArray(p.storage)?p.storage[0].size:p.storage.size}u++}localStorage.setItem("".concat(e.deploymentId.dseq),JSON.stringify({name:t.appName,image:s,cpu:a,memory:d,storage:l,sdl:r})),n(-1)},onError:function(e){Z.Z.error("UpdateDeployment.tsx"+e.message)}})),g({accounts:x.accounts,isSignedIn:!0})},onError:function(e){Z.Z.error("UpdateDeployment.tsx"+e.message)}})}catch(o){(0,k.V)(o)&&Z.Z.error("UpdateDeployment.tsx"+o.message),A("")}case 20:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),children:function(e){var r=e.values,t=e.submitForm;return(0,C.jsx)(b.E,{sdl:r.sdl,reviewSdl:M,closeReviewModal:q,configurationType:v.rs.Update,progressVisible:Y,cardMessage:N,onSave:t,actionItems:function(){return(0,C.jsxs)(f.Ow,{children:[(0,C.jsx)(V,{onClick:function(){return U(!0)},children:"View Parameter Editor"}),(0,C.jsx)(f.Lw,{onClick:function(){return n(-1)},children:"Cancel"}),(0,C.jsx)(f.k$,{onClick:function(){return t()},children:"Save"})]})}})}})},U=(0,g.iv)(y||(y=(0,t.Z)(["\n  padding: 10px 32px;\n  gap: 8px;\n  color: #374151;\n  text-transform: capitalize;\n  background-color: #ffffff;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\n  border: 1px solid #d7d7d7;\n  border-radius: 6px;\n\n  &:hover {\n    border-color: #3d4148;\n  }\n"]))),V=(0,c.Z)(x.Z)(w||(w=(0,t.Z)(["\n  ",";\n  margin-right: 20px;\n  border-radius: 8px;\n  font-family: 'Satoshi-Medium', sans-serif;\n  font-size: 14px;\n  box-shadow: 0px 1px 2px 0px #0000000d;\n\n  &:hover {\n    background-color: #f4f5f8;\n  }\n"])),U)}}]);
//# sourceMappingURL=5290.5f09b938.chunk.js.map